apiVersion: v1
kind: ConfigMap
metadata:
  name: flowforge-config
data:
  flowforge.yml: |
    port: 3000
    host: 0.0.0.0
    domain: {{ .Values.forge.domain }}
    {{- if .Values.forge.entryPoint }}
    base_url: https://{{ .Values.forge.entryPoint }}
    {{- else }}
    base_url: https://forge.{{ .Values.forge.domain }}
    {{- end }}
    api_url: http://forge.{{ .Release.Namespace }}
    db:
      type: postgres
      host: {{ .Release.Name }}-postgresql
      {{- if and (not .Values.forge.localPostgresql) (.Values.forge.postgres) }}
      port: {{ .Values.forge.postgres.port | default 5432 }}
      {{- end }}
      user: {{ .Values.forge.dbUsername }}
      password: {{ .Values.forge.dbPassword }}
    driver:
      type: kubernetes
      options:
        registry: {{ .Values.forge.registry }}
    {{- if .Values.forge.email }}
    email:
      enabled: true
      {{- if .Values.forge.email.from }}
      from: {{ .Values.forge.email.from | quote }}
      {{- end}}
    {{- if .Values.forge.email.smtp }}
      smtp:
        host: {{ .Values.forge.email.smtp.host }}
        port: {{ .Values.forge.email.smtp.port | default 587  }}
        secure: {{ .Values.forge.email.smtp.tls | default false  }}
        auth:
          user: {{ .Values.forge.email.smtp.user }}
          pass: {{ .Values.forge.email.smtp.password }}
    {{- end }}
    {{- if .Values.forge.email.ses }}
      ses:
        region: {{ .Values.forge.email.ses.region }}
    {{- end }}
    {{- else }}
    email:
      enabled: false
    {{- end }}

